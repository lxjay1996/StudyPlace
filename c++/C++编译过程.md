# 编译过程

整个编译过程大致分为两步：

1. 编译：把文本形式的源代码翻译成极其语言，并形成目标文件
2. 链接：把目标文件、操作系统的启动代码和库文件组织起来形成可执行程序

## 1 编译

### 1.1 编译预处理

- 预处理就是做一些代码文本替换工作。编译器执行**预处理指令(以#开头)**，会得到不含#的`.i`文件。
- 拷贝`#include`包含的代码，进行`#define`宏定义的替换，处理条件编译指令(`#ifndef`、`#ifdef`、`#endif`)

### 1.2 编译优化

- 通过词法分析和语法分析，确定所有指令是否符合规则，之后翻译成汇编代码
- 将`.i`文件转换成`.s`文件

### 1.3 汇编

- 汇编过程就是把汇编语言翻译成目标机器指令，生成`.obj`目标文件。
- 目标文件由段组成，至少有两个段:
  - 代码段：包含主要程序的指令。该段可读可写，不可写
  - 数据段：存放程序用到的全局变量或静态数据。可读可写可执行

## 2 链接

`.obj`文件不能立即执行，还要通过链接过程（将相关的目标文件链接起来，将`.obj`文件转换为可执行文件），这是因为：

- 一个源文件可能调用了另一个源文件的函数或常量
- 在程序中调用了某个库文件中的函数


**总结：**  

![](/images/C++编译过程.png)
